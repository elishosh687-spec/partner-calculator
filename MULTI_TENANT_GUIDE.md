# 🎯 מדריך שימוש - מערכת Multi-Tenant

## ✅ מה השתנה?

המערכת עברה שדרוג מלא ממחשבון בודד למערכת multi-tenant מתקדמת:

### לפני:
- ❌ כל המשתמשים רואים את כל העסקאות
- ❌ אין הזדהות משתמשים
- ❌ אין הפרדה בין שותפים

### אחרי:
- ✅ כל שותף רואה רק את העסקאות שלו
- ✅ הבוס רואה את הכל ויכול לסנן לפי שותף
- ✅ מערכת אימות מאובטחת
- ✅ חוקי אבטחה ב-Firestore

---

## 🚀 איך להתחיל?

### שלב 1: הגדרת Firestore Security Rules

**זה קריטי! המערכת לא תעבוד נכון בלי זה.**

1. פתח את [Firebase Console](https://console.firebase.google.com)
2. בחר בפרויקט: **partner-calcilator**
3. עבור ל-**Firestore Database** → **Rules**
4. העתק את התוכן מקובץ `firestore.rules`
5. הדבק במקום החוקים הקיימים
6. לחץ **Publish**

📖 קרא עוד ב-`SECURITY_RULES_SETUP.md`

### שלב 2: יצירת Index ב-Firestore

Firebase דורש index למשתמשים עם סינון:

1. הרץ את האפליקציה
2. נסה להתחבר כשותף (לא בוס)
3. אם תקבל שגיאה על חוסר index, Firebase יציג לך קישור
4. לחץ על הקישור והמתן להקמת ה-index (2-3 דקות)

**או:**

הוסף את ה-index הזה ידנית ב-Firebase Console:
- **Collection**: `transactions`
- **Fields to index**:
  1. `partnerId` (Ascending)
  2. `createdAt` (Descending)
- **Query scope**: Collection

### שלב 3: הרצת האפליקציה

```bash
npm run dev
```

---

## 👥 תפקידים במערכת

### 🎩 בוס (Boss)
**יכולות:**
- ✅ רואה את **כל** העסקאות של **כל** השותפים
- ✅ יכול לסנן עסקאות לפי שותף ספציפי
- ✅ רואה סטטיסטיקות כלליות
- ✅ יכול למחוק את כל ההיסטוריה
- ✅ רואה בטבלה מי השותף שיצר כל עסקה

**הבדל ויזואלי:**
- 👑 סמל כתר ליד השם
- תווית "מנהל" בסרגל העליון

### 🤝 שותף (Partner)
**יכולות:**
- ✅ רואה **רק** את העסקאות שהוא יצר
- ✅ יוצר עסקאות חדשות
- ✅ יכול למחוק את ההיסטוריה שלו בלבד
- ❌ לא רואה עסקאות של שותפים אחרים

**הבדל ויזואלי:**
- 👤 סמל משתמש רגיל
- אין תווית מיוחדת

---

## 📝 זרימת עבודה

### יצירת חשבון ראשון (הבוס)
1. הרץ את האפליקציה
2. לחץ "אין לך חשבון? הירשם"
3. מלא פרטים:
   - **שם**: הכנס את שמך
   - **תפקיד**: בחר **בוס** 👑
   - **אימייל**: example@email.com
   - **סיסמה**: לפחות 6 תווים
4. לחץ "צור חשבון"

### הוספת שותפים
1. שלח למשתמש החדש את הלינק לאפליקציה
2. המשתמש לוחץ "הירשם"
3. בוחר תפקיד **שותף**
4. ממלא את הפרטים ונרשם

### שימוש יומיומי - שותף
1. התחבר עם האימייל והסיסמה שלך
2. השתמש במחשבון כרגיל
3. כל העסקאות שלך נשמרות אוטומטית
4. רק אתה רואה אותן!

### שימוש יומיומי - בוס
1. התחבר כבוס
2. בטאב "היסטוריה" תראה:
   - כפתורי סינון לפי שותף
   - עמודה נוספת בטבלה: "שותף"
   - סטטיסטיקות מרוכזות
3. לחץ על שם שותף כדי לראות רק את העסקאות שלו

---

## 🎨 ממשק המשתמש

### מסך התחברות
- שדה אימייל (אנגלית)
- שדה סיסמה (עם אפשרות להצגה/הסתרה)
- החלפה בין התחברות והרשמה
- הודעות שגיאה בעברית

### סרגל עליון (Header)
- כרטיס משתמש:
  - 👑 סמל תפקיד (כתר/משתמש)
  - שם המשתמש
  - תווית "מנהל" (לבוס)
- כפתור יציאה (אדום)

### מסך היסטוריה - בוס
- **פאנל סינון**:
  - כפתור "כולם" - מציג את כל העסקאות
  - כפתור לכל שותף עם מספר העסקאות שלו
- **טבלה מורחבת**:
  - עמודה: תאריך
  - עמודה: לקוח
  - עמודה: שותף (חדש!)
  - עמודה: חלק אלי
  - עמודה: חלק שמעון

---

## 🔒 אבטחת מידע

### מה מוגן?
1. **הפרדת נתונים**: כל שותף רואה רק את שלו
2. **אימות חובה**: אי אפשר לגשת בלי התחברות
3. **חוקי Firestore**: המערכת מונעת גישה לא מורשית גם ברמת השרת
4. **הצפנת סיסמאות**: Firebase מטפל בזה אוטומטית

### מה לא מוגן (עדיין)?
- אין אימות דו-שלבי (2FA)
- אין מגבלת ניסיונות התחברות
- אין מערכת שחזור סיסמה (אפשר להוסיף)

---

## 🛠️ פתרון בעיות נפוצות

### בעיה: "Missing or insufficient permissions"
**פתרון**: 
1. וודא שהעלית את חוקי האבטחה ל-Firestore
2. בדוק ש-`firestore.rules` הועלה נכון

### בעיה: "The query requires an index"
**פתרון**: 
1. לחץ על הקישור ששולח Firebase
2. או הוסף index ידנית כמתואר למעלה

### בעיה: "Email already in use"
**פתרון**: 
- האימייל הזה כבר רשום, השתמש באימייל אחר או התחבר

### בעיה: שותף רואה עסקאות של אחרים
**פתרון**: 
- 🚨 זה אומר שחוקי האבטחה לא הוגדרו!
- עלה את `firestore.rules` מיד

### בעיה: לא רואה כפתור סינון (בוס)
**פתרון**: 
- צריך שיהיו לפחות 2 שותפים עם עסקאות
- וודא שאתה מחובר כבוס (סמל 👑)

---

## 📊 מבנה הנתונים

### Collection: `users`
```javascript
{
  id: "uid_from_firebase_auth",
  name: "אלי כהן",
  email: "eli@example.com",
  role: "partner" | "boss",
  createdAt: Timestamp
}
```

### Collection: `transactions`
```javascript
{
  id: "auto_generated",
  partnerId: "uid_של_השותף",
  partnerName: "אלי כהן",
  customerName: "לקוח ABC",
  date: "2025-01-15",
  totalRevenue: 10000,
  totalExpenses: 2000,
  netProfit: 8000,
  eliShare: 1600,
  shimonShare: 6400,
  eliPercentage: 20,
  shimonPercentage: 80,
  createdAt: Timestamp
}
```

---

## 🎓 טיפים לשימוש

### לבוסים:
1. 💡 השתמש בסינון כדי לראות ביצועים של כל שותף
2. 💡 עקוב אחרי הסטטיסטיקות לזיהוי טרנדים
3. 💡 בדוק באופן קבוע מי מהשותפים פעיל

### לשותפים:
1. 💡 הזן כל עסקה מיד - אל תשכח!
2. 💡 השתמש בשמות לקוח ברורים למעקב
3. 💡 בדוק את ההיסטוריה לסיכום חודשי

---

## 🔮 תכונות עתידיות אפשריות

רעיונות להוספה:
- [ ] שחזור סיסמה באימייל
- [ ] דוחות חודשיים/שנתיים
- [ ] ייצוא לאקסל
- [ ] התראות על עסקאות חדשות
- [ ] גרפים וויזואליזציות
- [ ] מצב כהה/בהיר
- [ ] שפות נוספות
- [ ] ניהול אחוזים מותאם אישית לכל שותף

---

## 📞 תמיכה

אם יש בעיות או שאלות:
1. בדוק את הלוגים בקונסול הדפדפן (F12)
2. בדוק את Firestore Rules ב-Firebase Console
3. וודא שהמשתמש רשום במסד הנתונים

**זכור**: המערכת מאובטחת כעת! כל שינוי בחוקי האבטחה דורש זהירות.

