# הגדרת Firestore Security Rules

## 📋 הוראות התקנה

### שלב 1: העתקת חוקי האבטחה
1. פתח את [Firebase Console](https://console.firebase.google.com)
2. בחר בפרויקט שלך: **partner-calcilator**
3. עבור ל-**Firestore Database** בתפריט הצד
4. לחץ על הטאב **Rules** (חוקים)

### שלב 2: העתק והדבק
1. העתק את כל התוכן מקובץ `firestore.rules` שבפרויקט
2. הדבק אותו במקום החוקים הקיימים ב-Firebase Console
3. לחץ על **Publish** (פרסם)

### שלב 3: אימות
אחרי הפרסום, וודא ש:
- ✅ החוקים פורסמו ללא שגיאות
- ✅ המערכת מאפשרת למשתמשים מחוברים לגשת למידע שלהם בלבד

---

## 🔒 מה החוקים מבטיחים?

### אוסף Users (משתמשים)
- ✅ **קריאה**: משתמש רואה רק את המידע שלו; בוס רואה את כל המשתמשים
- ✅ **יצירה**: רק במהלך הרשמה
- ✅ **עדכון**: משתמש יכול לעדכן את הפרטים שלו (לא את התפקיד)
- ❌ **מחיקה**: אסורה לכולם

### אוסף Transactions (עסקאות)
- ✅ **קריאה**: 
  - שותף רואה רק את העסקאות שלו
  - בוס רואה את כל העסקאות של כל השותפים
  
- ✅ **יצירה**: 
  - רק משתמש מחובר
  - partnerId חייב להיות זהה למשתמש המחובר
  - כל השדות הנדרשים חייבים להיות קיימים
  
- ✅ **עדכון**: 
  - רק בעל העסקה
  - לא ניתן לשנות את partnerId
  
- ✅ **מחיקה**: 
  - בעל העסקה או בוס

---

## 🧪 בדיקת החוקים

### בדיקה 1: שותף רואה רק את שלו
```javascript
// שותף A מנסה לקרוא עסקאות של שותף B
// ✅ התוצאה: שגיאת הרשאה
```

### בדיקה 2: בוס רואה הכל
```javascript
// בוס קורא את כל העסקאות
// ✅ התוצאה: מקבל את כל העסקאות של כל השותפים
```

### בדיקה 3: שותף לא יכול לזייף partnerId
```javascript
// שותף A מנסה ליצור עסקה עם partnerId של שותף B
// ✅ התוצאה: שגיאת הרשאה
```

---

## 🚨 אזהרות חשובות

1. **לעולם אל תסיר את החוקים** - זה יחשוף את כל הנתונים לכולם
2. **אל תשנה את התפקידים ידנית** - השתמש רק במערכת ההרשמה
3. **בדוק את החוקים לפני פרסום** - Firebase Console מציע סימולטור לבדיקה

---

## 🔧 עדכון חוקים עתידי

אם תרצה להוסיף תכונות נוספות, זכור:
- תמיד שמור על העיקרון: שותף רואה רק את שלו
- בוס תמיד רואה הכל
- וודא שהשדה partnerId לא ניתן לשינוי
- בדוק את השינויים בסביבת פיתוח לפני פרסום לייצור

---

## 📞 צריך עזרה?

אם אתה נתקל בבעיות עם חוקי האבטחה:
1. בדוק את הלוגים ב-Firebase Console
2. השתמש ב-Rules Playground לבדיקת תרחישים
3. וודא שהשדה `role` קיים במסמכי המשתמשים

